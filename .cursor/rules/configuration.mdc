---
description: "Configuration file format and repository settings"
globs: "*.yaml,config*.go"
---

# Configuration Management

## Configuration File Format

- Primary config: `repositories.yaml` (YAML format)
- Example: [example-repositories.yaml](mdc:example-repositories.yaml)
- Parser: [config.go](mdc:config.go)
- Uses `gopkg.in/yaml.v3` for parsing

## Configuration Structure

### Organization Settings (Required)

```yaml
organization: "org-name"
```

### Team Permissions

```yaml
teams:
  - name: "team-name"
    permission: "admin" | "push" | "pull" | "triage" | "maintain"
```

### Repository Configuration

```yaml
repositories:
  - name: "repo-name"
    description: "Repository description"
    private: true | false
    has_wiki: true | false
    has_issues: true | false
    has_projects: true | false
    default_labels: true | false
    teams:
      - name: "team-name"
        permission: "admin" | "push" | "pull"
```

### Branch Protection

```yaml
    branch_protections:
      - pattern: "main"
        required_reviews: 2
        dismiss_stale_reviews: true
        require_code_owner_reviews: true
        required_status_checks:
          - "ci/test"
          - "ci/lint"
        enforce_admins: true
        allow_force_pushes: false
        allow_deletions: false
```

### Merge Strategy Controls

```yaml
    allow_merge_commit: true
    allow_squash_merge: true
    allow_rebase_merge: false
```

## Configuration Validation

- Type safety via Go structs
- Required field validation
- Team permission level validation
- Future: `validate` command for pre-flight checks (task-28)

## Configuration Import

- Import existing repository settings: `ownershit import`
- Implementation: [import.go](mdc:import.go)
- Supports importing branch protection rules (task-27)

## Best Practices

- Store organization configs outside the repository (security)
- Use meaningful team and permission names
- Enable branch protection for main/production branches
- Set `default_labels: true` for consistent labeling
- Validate configuration before syncing

## Testing Configuration

- Test fixtures: [testdata/testrepoconfig.yaml](mdc:testdata/testrepoconfig.yaml)
- Config parsing tests: [config_parsing_test.go](mdc:config_parsing_test.go)
- Permission tests: [config_permissions_test.go](mdc:config_permissions_test.go)
